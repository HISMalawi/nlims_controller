---
openapi: 3.0.1
info:
  title: NLIMS API
  version: v1
paths:
  "/api/v1/re_authenticate/{username}/{password}":
    get:
      summary: Login
      tags:
      - Users
      parameters:
      - name: username
        in: path
        required: true
        schema:
          type: string
      - name: password
        in: path
        required: true
        schema:
          type: string
      responses:
        '200':
          description: successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: integer
                    example: 200
                  error:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: re authentication successfuly
                  data:
                    type: object
                    properties:
                      token:
                        type: string
                        example: pgq13sZpUFT6
                      expiry_time:
                        type: string
                        example: '20231017180719'
        '401':
          description: unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: integer
                    example: 401
                  error:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: wrong username or password
                  data:
                    type: object
                    example: {}
  "/api/v1/create_order":
    post:
      summary: create_order order
      tags:
      - Order
      parameters: []
      responses:
        '200':
          description: Order creation successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: integer
                    example: 200
                  error:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: order created successfully
                  data:
                    type: object
                    properties:
                      tracking_number:
                        type: string
                        example: xkch123s2
                        description: Tracking number tied to the order
                      couch_id:
                        type: string
                        example: cdrjtgwit4065680285843
                        description: CouchDB id tied to the order
        '409':
          description: Order with such tracking number already exists
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: integer
                    example: 200
                  error:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: order already available
                  data:
                    type: object
                    properties:
                      tracking_number:
                        type: string
                        example: xkch123s2
                        description: Tracking number tied to the order
        '401':
          description: Error
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: integer
                    example: 401
                  error:
                    type: boolean
                    example: true
                  message:
                    type: string
                  data:
                    type: object
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                district:
                  type: string
                  example: Mzimba
                  description: District where the order is coming from
                health_facility_name:
                  type: string
                  example: Mzimba South Health Centre
                  description: Name of the health facility where the order is coming
                    from
                requesting_clinician:
                  type: string
                  example: Dr. John Doe
                  description: Name of the clinician requesting the order
                first_name:
                  type: string
                  example: John
                  description: First name of the patient
                last_name:
                  type: string
                  example: Doe
                  description: Last name of the patient
                phone_number:
                  type: string
                  example: '0888888888'
                  description: Phone number of the patient
                gender:
                  type: string
                  example: F
                  description: Gender of the patient
                  enum:
                  - M
                  - F
                national_patient_id:
                  type: string
                  example: '123456789'
                  description: National patient Identifier of the patient
                sample_type:
                  type: string
                  example: Blood
                  description: Sample type
                tests:
                  type: array
                  items:
                    type: string
                    example: FBC
                  description: Tests to be performed on the sample
                date_sample_drawn:
                  type: string
                  example: '2023-10-17T14:57:18.000+02:00'
                  description: Date sample was drawn
                sample_status:
                  type: string
                  example: specimen_not_collected
                  description: Sample status
                  enum:
                  - specimen_not_collected
                  - specimen_accepted
                  - specimen_rejected
                  - specimen_collected
                sample_priority:
                  type: string
                  example: routine
                  description: Reason for testing
                target_lab:
                  type: string
                  example: Lighthouse
                  description: Target lab is the lab where the sample is going to
                    be tested
                order_location:
                  type: string
                  example: Mzimba South Health Centre
                  description: Order location is the health facility or ward where
                    the sample has been collected from
                who_order_test_first_name:
                  type: string
                  example: John
                  description: First name of the person who drew the test
                who_order_test_last_name:
                  type: string
                  example: Doe
                  description: Last name of the person who drew the test
                tracking_number:
                  type: string
                  example: xkch123s2
                  description: Tracking number aka the national accession number of
                    the order
              required:
              - district
              - health_facility_name
              - requesting_clinician
              - first_name
              - last_name
              - gender
              - sample_type
              - tests
              - date_sample_drawn
              - sample_priority
              - target_lab
              - order_location
              - sample_status
  "/api/v1/query_results_by_tracking_number/{tracking_number}":
    parameters:
    - name: tracking_number
      in: path
      description: Tracking number of the order in question
      required: true
      schema:
        type: string
    get:
      summary: Query order results by tracking number
      tags:
      - Order
      responses:
        '200':
          description: results retrieved successfuly
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: integer
                    example: 200
                  error:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: results retrieved successfuly
                  data:
                    type: object
                    properties:
                      tracking_number:
                        type: string
                        example: xhce232s23
                        description: Tracking number tied to the order
                      results:
                        type: object
                        properties:
                          FBC:
                            type: object
                            properties:
                              RBC:
                                type: string
                                example: '4.13'
                              HGB:
                                type: string
                                example: '12.5'
                              HCT:
                                type: string
                                example: '37.6'
                              MCV:
                                type: string
                                example: '91.0'
                              MCH:
                                type: string
                                example: '30.3'
                              MCHC:
                                type: string
                                example: '33.2'
                              PLT:
                                type: string
                                example: '97.0'
                              PDW:
                                type: string
                                example: '13.0'
                              MPV:
                                type: string
                                example: '10.9'
                              PCT:
                                type: string
                                example: '0.11'
                              MONO#:
                                type: string
                                example: '0.23'
                              P-LCC:
                                type: string
                                example: '0.23'
                              result_date:
                                type: string
                                example: '2016-05-23'
                          Viral Load:
                            type: object
                            properties:
                              Viral Load:
                                type: string
                                example: "< LDL"
                              result_date:
                                type: string
                                example: '2016-05-23'
        '401':
          description: Error or results not available
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: integer
                    example: 401
                  error:
                    type: boolean
                    example: true
                  message:
                    type: string
                  data:
                    type: object
  "/api/v1/query_order_by_tracking_number/{tracking_number}":
    parameters:
    - name: tracking_number
      in: path
      description: tracking_number
      required: true
      schema:
        type: string
    get:
      summary: query_order_by_tracking_number order
      tags:
      - Order
      responses:
        '200':
          description: successful
  "/api/v1/query_order_by_npid/{npid}":
    parameters:
    - name: npid
      in: path
      description: npid
      required: true
      schema:
        type: string
    get:
      summary: query_order_by_npid order
      tags:
      - Order
      responses:
        '200':
          description: successful
  "/api/v1/query_results_by_npid/{npid}":
    parameters:
    - name: npid
      in: path
      description: npid
      required: true
      schema:
        type: string
    get:
      summary: query_results_by_npid order
      tags:
      - Order
      responses:
        '200':
          description: successful
  "/api/v1/update_order":
    post:
      summary: update_order order
      tags:
      - Order
      responses:
        '200':
          description: successful
  "/api/v1/query_requested_order_by_npid/{npid}":
    parameters:
    - name: npid
      in: path
      description: npid
      required: true
      schema:
        type: string
    get:
      summary: query_requested_order_by_npid order
      tags:
      - Order
      responses:
        '200':
          description: successful
  "/api/v1/dispatch_sample":
    post:
      summary: dispatch_sample order
      tags:
      - Order
      responses:
        '200':
          description: successful
  "/api/v1/check_if_dispatched/{tracking_number}":
    parameters:
    - name: tracking_number
      in: path
      description: tracking_number
      required: true
      schema:
        type: string
    get:
      summary: check_if_dispatched order
      tags:
      - Order
      responses:
        '200':
          description: successful
  "/api/v1/retrieve_undispatched_samples":
    get:
      summary: retrieve_undispatched_samples order
      tags:
      - Order
      responses:
        '200':
          description: successful
  "/api/v1/retrieve_samples/{order_date}/{region}":
    parameters:
    - name: order_date
      in: path
      description: order_date
      required: true
      schema:
        type: string
    - name: region
      in: path
      description: region
      required: true
      schema:
        type: string
    get:
      summary: retrieve_samples order
      tags:
      - Order
      responses:
        '200':
          description: successful
  "/api/v1/sites":
    get:
      summary: list sites
      tags:
      - Sites
      parameters:
      - name: q
        in: query
        description: Search name of site query
        schema:
          type: string
      responses:
        '200':
          description: successful
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                      example: 2331
                    name:
                      type: string
                      example: Kamuzu Academy Clinic
                    district:
                      type: string
                      example: kasungu
                    x:
                      type: number
                      format: float
                      example: 33.6884
                    y:
                      type: number
                      format: float
                      example: -13.0294
                    region:
                      type: string
                      example: Central
                    description:
                      type: string
                      example: Clinic
                    enabled:
                      type: boolean
                      example: false
                    sync_status:
                      type: boolean
                      example: false
                    site_code:
                      type: string
                      example: ''
                    application_port:
                      type: string
                      example: '0000'
                    host_address:
                      type: string
                      example: ''
                    couch_username:
                      type: string
                      example: ''
                    couch_password:
                      type: string
                      example: ''
                    created_at:
                      type: string
                      format: date-time
                      example: '2021-07-29T11:24:55.000+02:00'
                    updated_at:
                      type: string
                      format: date-time
                      example: '2021-07-29T11:24:55.000+02:00'
                    site_code_number:
                      type: integer
                      example: KAC
    post:
      summary: create site
      tags:
      - Sites
      parameters: []
      responses:
        '200':
          description: successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                    example: 2331
                  name:
                    type: string
                    example: Kamuzu Academy Clinic
                  district:
                    type: string
                    example: kasungu
                  x:
                    type: number
                    format: float
                    example: 33.6884
                  y:
                    type: number
                    format: float
                    example: -13.0294
                  region:
                    type: string
                    example: Central
                  description:
                    type: string
                    example: Clinic
                  enabled:
                    type: boolean
                    example: false
                  sync_status:
                    type: boolean
                    example: false
                  site_code:
                    type: string
                    example: ''
                  application_port:
                    type: string
                    example: '0000'
                  host_address:
                    type: string
                    example: ''
                  couch_username:
                    type: string
                    example: ''
                  couch_password:
                    type: string
                    example: ''
                  created_at:
                    type: string
                    format: date-time
                    example: '2021-07-29T11:24:55.000+02:00'
                  updated_at:
                    type: string
                    format: date-time
                    example: '2021-07-29T11:24:55.000+02:00'
                  site_code_number:
                    type: integer
                    example: KAC
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  example: Kamuzu Academy Clinic
                district:
                  type: string
                  example: kasungu
                x:
                  type: number
                  format: float
                  example: 33.6884
                y:
                  type: number
                  format: float
                  example: -13.0294
                region:
                  type: string
                  example: Central
                description:
                  type: string
                  example: Clinic
                enabled:
                  type: boolean
                  example: false
                site_code:
                  type: string
                  example: ''
                application_port:
                  type: string
                  example: '0000'
                host_address:
                  type: string
                  example: ''
                couch_username:
                  type: string
                  example: ''
                couch_password:
                  type: string
                  example: ''
                created_at:
                  type: string
                  format: date-time
                  example: '2021-07-29T11:24:55.000+02:00'
                updated_at:
                  type: string
                  format: date-time
                  example: '2021-07-29T11:24:55.000+02:00'
                site_code_number:
                  type: integer
                  example: KAC
  "/api/v1/sites/{id}":
    parameters:
    - name: id
      in: path
      description: id
      required: true
      schema:
        type: integer
    get:
      summary: show site
      tags:
      - Sites
      responses:
        '200':
          description: successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                    example: 2331
                  name:
                    type: string
                    example: Kamuzu Academy Clinic
                  district:
                    type: string
                    example: kasungu
                  x:
                    type: number
                    format: float
                    example: 33.6884
                  y:
                    type: number
                    format: float
                    example: -13.0294
                  region:
                    type: string
                    example: Central
                  description:
                    type: string
                    example: Clinic
                  enabled:
                    type: boolean
                    example: false
                  sync_status:
                    type: boolean
                    example: false
                  site_code:
                    type: string
                    example: ''
                  application_port:
                    type: string
                    example: '0000'
                  host_address:
                    type: string
                    example: ''
                  couch_username:
                    type: string
                    example: ''
                  couch_password:
                    type: string
                    example: ''
                  created_at:
                    type: string
                    format: date-time
                    example: '2021-07-29T11:24:55.000+02:00'
                  updated_at:
                    type: string
                    format: date-time
                    example: '2021-07-29T11:24:55.000+02:00'
                  site_code_number:
                    type: integer
                    example: KAC
    put:
      summary: update site
      tags:
      - Sites
      parameters: []
      responses:
        '200':
          description: successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                    example: 2331
                  name:
                    type: string
                    example: Kamuzu Academy Clinic
                  district:
                    type: string
                    example: kasungu
                  x:
                    type: number
                    format: float
                    example: 33.6884
                  y:
                    type: number
                    format: float
                    example: -13.0294
                  region:
                    type: string
                    example: Central
                  description:
                    type: string
                    example: Clinic
                  enabled:
                    type: boolean
                    example: false
                  sync_status:
                    type: boolean
                    example: false
                  site_code:
                    type: string
                    example: ''
                  application_port:
                    type: string
                    example: '0000'
                  host_address:
                    type: string
                    example: ''
                  couch_username:
                    type: string
                    example: ''
                  couch_password:
                    type: string
                    example: ''
                  created_at:
                    type: string
                    format: date-time
                    example: '2021-07-29T11:24:55.000+02:00'
                  updated_at:
                    type: string
                    format: date-time
                    example: '2021-07-29T11:24:55.000+02:00'
                  site_code_number:
                    type: integer
                    example: KAC
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  example: Kamuzu Academy Clinic
                district:
                  type: string
                  example: kasungu
                x:
                  type: number
                  format: float
                  example: 33.6884
                y:
                  type: number
                  format: float
                  example: -13.0294
                region:
                  type: string
                  example: Central
                description:
                  type: string
                  example: Clinic
                enabled:
                  type: boolean
                  example: false
                site_code:
                  type: string
                  example: ''
                application_port:
                  type: string
                  example: '0000'
                host_address:
                  type: string
                  example: ''
                couch_username:
                  type: string
                  example: ''
                couch_password:
                  type: string
                  example: ''
                created_at:
                  type: string
                  format: date-time
                  example: '2021-07-29T11:24:55.000+02:00'
                updated_at:
                  type: string
                  format: date-time
                  example: '2021-07-29T11:24:55.000+02:00'
                site_code_number:
                  type: integer
                  example: KAC
  "/api/v2/csig/generate_ids":
    post:
      summary: generate specimen tracking ids
      tags:
      - CSIG
      parameters: []
      responses:
        '200':
          description: successful
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                      example: 221200
                    sequence_number:
                      type: string
                      example: '221200'
                    base9_equivalent:
                      type: string
                      example: '366377'
                    base9_zero_padded:
                      type: string
                      example: '0000366377'
                    encrypted:
                      type: string
                      example: '2155087835'
                    encrypted_zero_cleaned:
                      type: string
                      example: '3266198946'
                    check_digit:
                      type: string
                      example: '74'
                    sin:
                      type: string
                      example: '743266198946'
                    created_at:
                      type: string
                      format: date-time
                      example: '2023-10-17T14:57:18.000+02:00'
                    updated_at:
                      type: string
                      format: date-time
                      example: '2023-10-17T14:57:18.000+02:00'
                    distributed:
                      type: boolean
                      example: false
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                number_of_ids:
                  type: integer
                  example: 10
                  default: 100
              required:
              - number_of_ids
  "/api/v2/csig/distribute_ids":
    post:
      summary: distribute specimen tracking ids
      tags:
      - CSIG
      parameters: []
      responses:
        '200':
          description: successful
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                sites:
                  type: array
                  items:
                    type: integer
                number_of_ids:
                  type: integer
              required:
              - sites
              - number_of_ids
  "/api/v2/csig/sin_used":
    get:
      summary: check if specimen tracking id is used
      tags:
      - CSIG
      parameters:
      - name: sin
        in: query
        required: true
        schema:
          type: string
      responses:
        '200':
          description: successful
  "/api/v2/csig/use_sin":
    post:
      summary: use_sin csig
      tags:
      - CSIG
      parameters: []
      responses:
        '200':
          description: successful
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                sin:
                  type: string
                site_name:
                  type: string
                system_name:
                  type: string
              required:
              - sin
              - site_name
  "/api/v2/csig":
    get:
      summary: list csig specimen tracking ids
      tags:
      - CSIG
      parameters:
      - name: per_page
        in: query
        required: false
        schema:
          type: integer
      - name: page_number
        in: query
        required: false
        schema:
          type: integer
      - name: distributed
        in: query
        required: false
        schema:
          type: boolean
      - name: status
        in: query
        required: false
        schema:
          type: integer
      - name: q
        in: query
        required: false
        schema:
          type: string
      responses:
        '200':
          description: successful
  "/api/v2/csig/status":
    get:
      summary: list csig statuses
      tags:
      - CSIG
      responses:
        '200':
          description: successful
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                      example: 1
                    name:
                      type: string
                      example: Not Distributed
                    description:
                      type: string
                      example: Not Distributed
                    created_at:
                      type: string
                      format: date-time
                      example: '2023-10-17T14:57:18.000+02:00'
  "/api/v2/csig/not_distributed_ids_count":
    get:
      summary: Get total count of ids not distributed
      tags:
      - CSIG
      responses:
        '200':
          description: successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: integer
                    example: 1
servers:
- url: http://{defaultHost}
  variables:
    defaultHost:
      default: localhost:3009
components:
  securitySchemes:
    authorization:
      type: apiKey
      name: token
      in: header
security:
- authorization: []
